import{b as d,t as e,w as ie,A as le,L as A}from"./index-Djl51xko.js";import{B as y,b as N,f as de,r as B,u as O,a as ue,L as R,d as me}from"./label-DahRaslS.js";import{B as q}from"./button-group-Sq6WdPxg.js";import{S as E,a as L}from"./homeStyle-brh0olfs.js";import{c as he,t as C,d as pe,P as D,u as xe,b as H,f as fe}from"./index-DE4h2VEI.js";import{C as z}from"./ConfirmDialog-jIALXBh6.js";import{u as ge,g as je,a as be,e as Ce,d as ke}from"./firestore_utils-DVQETLsh.js";import{u as w}from"./useTranslation--5zCHKf_.js";import{a as W,u as $,b as S}from"./react-C6GO0r9T.js";import{C as U,a as ve,b as _e,c as ye}from"./card-DP1A_csb.js";import{u as Ne,C as we,S as Se,F as Ie}from"./index-BluoId--.js";import{B as M}from"./badge-DWtvmZof.js";import{D as G,a as Pe,b as K,c as V,d as Y,e as X}from"./dialog-CZA1q8pS.js";import{I as Re}from"./input-BbUSEJaE.js";import{P as Ee,T as Le}from"./textarea-BZaXx_cY.js";import{u as Be,B as De,c as Fe}from"./index-DsvhI0vr.js";import{T as Te}from"./trash-2-DZCgiI5G.js";import{B as Ae}from"./BackgroundSpinner-BmPeNkxa.js";import{H as He,a as Ue}from"./commonStyle-CMqu6ffv.js";import{M as Me}from"./messages-square-w-ngK0CV.js";const Oe=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],qe=he("pencil",Oe);function ze(){const{t}=w(),[n,r]=W(N),i=["Beginner","Intermediate","Advanced"],[o,a]=d.useState(n?.course),l=async()=>{if(n)try{await ge(n.uid,o),r({...n,course:o}),C.success("コースが変更されました")}catch(c){console.error("Failed to update course:",c),C.error("コースの変更に失敗しました。")}};return e.jsxs(e.Fragment,{children:[e.jsx(q,{orientation:"vertical",className:"my-4 gap-1",children:i.map((c,s)=>e.jsx(y,{variant:o===c?"default":"outline",onClick:()=>a(c),disabled:s===1||s===2,children:t(c==="Beginner"?"course.Beginner":c==="Intermediate"?"course.Intermediate":"course.Advanced")},c))}),e.jsx(z,{buttonLabel:t("common.change"),triggerVariant:"ghost",triggerDisabled:n?.course===o,title:"コース変更の確認",titleWithIcon:"info",description:`コースを「${o}」に変更しますか？`,onConfirm:l})]})}const We=de(t=>({queryKey:["notice",t(B),t(N)],queryFn:async({queryKey:n})=>{const[,,r]=n;return r?await je():null}}));var I="Checkbox",[$e]=fe(I),[Ge,F]=$e(I);function Ke(t){const{__scopeCheckbox:n,checked:r,children:i,defaultChecked:o,disabled:a,form:l,name:c,onCheckedChange:s,required:x,value:g="on",internal_do_not_use_render:u}=t,[f,b]=xe({prop:r,defaultProp:o??!1,onChange:s,caller:I}),[j,k]=d.useState(null),[v,m]=d.useState(null),h=d.useRef(!1),p=j?!!l||!!j.closest("form"):!0,P={checked:f,disabled:a,setChecked:b,control:j,setControl:k,name:c,form:l,value:g,hasConsumerStoppedPropagationRef:h,required:x,defaultChecked:_(o)?!1:o,isFormControl:p,bubbleInput:v,setBubbleInput:m};return e.jsx(Ge,{scope:n,...P,children:Ve(u)?u(P):i})}var Q="CheckboxTrigger",J=d.forwardRef(({__scopeCheckbox:t,onKeyDown:n,onClick:r,...i},o)=>{const{control:a,value:l,disabled:c,checked:s,required:x,setControl:g,setChecked:u,hasConsumerStoppedPropagationRef:f,isFormControl:b,bubbleInput:j}=F(Q,t),k=O(o,g),v=d.useRef(s);return d.useEffect(()=>{const m=a?.form;if(m){const h=()=>u(v.current);return m.addEventListener("reset",h),()=>m.removeEventListener("reset",h)}},[a,u]),e.jsx(D.button,{type:"button",role:"checkbox","aria-checked":_(s)?"mixed":s,"aria-required":x,"data-state":re(s),"data-disabled":c?"":void 0,disabled:c,value:l,...i,ref:k,onKeyDown:H(n,m=>{m.key==="Enter"&&m.preventDefault()}),onClick:H(r,m=>{u(h=>_(h)?!0:!h),j&&b&&(f.current=m.isPropagationStopped(),f.current||m.stopPropagation())})})});J.displayName=Q;var Z=d.forwardRef((t,n)=>{const{__scopeCheckbox:r,name:i,checked:o,defaultChecked:a,required:l,disabled:c,value:s,onCheckedChange:x,form:g,...u}=t;return e.jsx(Ke,{__scopeCheckbox:r,checked:o,defaultChecked:a,disabled:c,required:l,onCheckedChange:x,name:i,form:g,value:s,internal_do_not_use_render:({isFormControl:f})=>e.jsxs(e.Fragment,{children:[e.jsx(J,{...u,ref:n,__scopeCheckbox:r}),f&&e.jsx(ne,{__scopeCheckbox:r})]})})});Z.displayName=I;var ee="CheckboxIndicator",te=d.forwardRef((t,n)=>{const{__scopeCheckbox:r,forceMount:i,...o}=t,a=F(ee,r);return e.jsx(pe,{present:i||_(a.checked)||a.checked===!0,children:e.jsx(D.span,{"data-state":re(a.checked),"data-disabled":a.disabled?"":void 0,...o,ref:n,style:{pointerEvents:"none",...t.style}})})});te.displayName=ee;var se="CheckboxBubbleInput",ne=d.forwardRef(({__scopeCheckbox:t,...n},r)=>{const{control:i,hasConsumerStoppedPropagationRef:o,checked:a,defaultChecked:l,required:c,disabled:s,name:x,value:g,form:u,bubbleInput:f,setBubbleInput:b}=F(se,t),j=O(r,b),k=Ne(a),v=Be(i);d.useEffect(()=>{const h=f;if(!h)return;const p=window.HTMLInputElement.prototype,T=Object.getOwnPropertyDescriptor(p,"checked").set,oe=!o.current;if(k!==a&&T){const ce=new Event("click",{bubbles:oe});h.indeterminate=_(a),T.call(h,_(a)?!1:a),h.dispatchEvent(ce)}},[f,k,a,o]);const m=d.useRef(_(a)?!1:a);return e.jsx(D.input,{type:"checkbox","aria-hidden":!0,defaultChecked:l??m.current,required:c,disabled:s,name:x,value:g,form:u,...n,tabIndex:-1,ref:j,style:{...n.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});ne.displayName=se;function Ve(t){return typeof t=="function"}function _(t){return t==="indeterminate"}function re(t){return _(t)?"indeterminate":t?"checked":"unchecked"}function Ye({className:t,...n}){return e.jsx(Z,{"data-slot":"checkbox",className:ue("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:e.jsx(te,{"data-slot":"checkbox-indicator",className:"grid place-content-center text-current transition-none",children:e.jsx(we,{className:"size-3.5"})})})}function ae({open:t,setOpen:n,isAdd:r,titleProps:i,contentProps:o,isImportantProps:a,noticeId:l,onCloseDetail:c}){const{t:s}=w(),[x,g]=d.useState(r?"":i),[u,f]=d.useState(r?"":o),[b,j]=d.useState(r?!1:a),[k,v]=d.useState(!1),m=$(B),h=async()=>{if(!x.trim()||!u.trim()){C.success(s("notice.notice_title_detail"));return}try{v(!0),r?(await be(x,u,!0,b),C(s("notice.notice_add_success"))):l?(await Ce(l,{title:x,content:u,isImportant:b}),C(s("notice.notice_edit_success"))):(console.error("Notice ID is missing for editing."),C.error(s("notice.notice_edit_fail"))),c&&c(null),n(!1),g(""),f(""),j(!1),m(p=>p+1)}catch(p){C(s("notice.notice_add_fail")),console.error(p)}finally{v(!1)}};return e.jsxs(G,{open:t,onOpenChange:n,children:[e.jsx(Pe,{asChild:!0,children:e.jsx(y,{size:"sm",children:r?e.jsx(Ee,{className:"w-4 h-4"}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 mr-1"}),s("common.edit")]})})}),e.jsxs(K,{className:"sm:max-w-lg",children:[e.jsx(V,{children:e.jsx(Y,{children:s(r?"notice.notice_add":"notice.notice_edit")})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(R,{htmlFor:"title",children:s("notice.notice_title")}),e.jsx(Re,{id:"title",value:x,onChange:p=>g(p.target.value),placeholder:s("notice.notice_title_detail")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(R,{htmlFor:"content",children:s("notice.notice_content")}),e.jsx(Le,{id:"content",value:u,onChange:p=>f(p.target.value),placeholder:s("notice.notice_content_detail"),rows:6})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{id:"important",checked:b,onCheckedChange:p=>j(p===!0)}),e.jsx(R,{htmlFor:"important",children:s("notice.notice_important")})]})]}),e.jsx(X,{children:e.jsx(y,{onClick:h,disabled:k,children:s("common.register")})})]})]})}function Xe({selectedNotice:t,setSelectedNotice:n,open:r,setOpen:i}){const{t:o}=w(),a=S(N),l=$(B),c=async()=>{if(t)try{await ke(t.id),C.success(o("notice.notice_delete_success")),n(null),l(s=>s+1)}catch(s){C.error(o("notice.notice_delete_fail")),console.error(s);return}};return e.jsx(G,{open:!!t,onOpenChange:()=>n(null),children:e.jsx(K,{className:"max-w-lg",children:t&&e.jsxs(e.Fragment,{children:[e.jsx(V,{children:e.jsx(Y,{children:t.title})}),e.jsx("div",{className:"text-sm text-muted-foreground mb-4",children:t.createdAt.toLocaleDateString()}),e.jsx("div",{className:"whitespace-pre-wrap text-sm mb-6",children:t.content}),(a?.authority==="admin"||a?.authority==="instructor")&&e.jsxs(X,{className:"flex justify-end gap-2",children:[e.jsx(ae,{open:r,setOpen:i,isAdd:!1,titleProps:t.title,contentProps:t.content,isImportantProps:t.isImportant??!1,noticeId:t.id,onCloseDetail:n}),e.jsx(z,{buttonLabel:e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4 mr-1"}),o("common.delete")]}),triggerVariant:"destructive",triggerDisabled:!1,triggerSize:"sm",title:o("notice.notice_delete_confirm"),titleWithIcon:"warning",cancleButtonLabel:o("common.cancel"),confirmButtonLabel:o("common.delete"),onConfirm:c})]})]})})})}function Qe(){const{t}=w(),n=S(N),[{data:r,isPending:i}]=W(We),[o,a]=d.useState(null),[l,c]=d.useState(!1);return i?e.jsx(Ae,{}):e.jsxs(e.Fragment,{children:[e.jsxs(U,{className:"w-1/3 max-w-1/3",children:[e.jsxs(ve,{className:"flex flex-row items-center justify-between",children:[e.jsx(_e,{children:"Notice"}),(n?.authority==="admin"||n?.authority==="instructor")&&e.jsx(ae,{open:l,setOpen:c,isAdd:!0,titleProps:"",contentProps:"",isImportantProps:!1})]}),e.jsx(ye,{children:e.jsx(Se,{className:"h-50 pr-4",children:e.jsxs("div",{className:"space-y-3",children:[r?.map(s=>e.jsxs(U,{onClick:()=>a(s),className:"cursor-pointer rounded-md border p-3 hover:bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.isImportant&&e.jsx(M,{variant:"destructive",children:t("notice.notice_important")}),s.isNew&&e.jsx(M,{variant:"secondary",children:"NEW"})]}),e.jsx("div",{className:"font-medium",children:s.title}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.createdAt.toLocaleDateString()})]},s.id)),r?.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-10",children:t("notice.notice_empty")})]})})})]}),e.jsx(Xe,{selectedNotice:o,setSelectedNotice:a,open:l,setOpen:c})]})}function jt({}){return[{title:"React Learning by Ryan"},{name:"React Learning",content:"Welcome to React Learning App!"}]}const bt=ie(function(){const n=S(N),r=S(Fe),{t:i}=w();return n?r?e.jsxs("main",{className:"p-8 flex flex-col justify-center items-center gap-2",children:[e.jsxs("h1",{className:`${He} flex items-center gap-3 tracking-wide`,children:[e.jsx(Ie,{id:"react-icon",className:"text-blue-600 animate-spin"}),e.jsx("span",{children:"React Learning"})]}),e.jsx(E,{className:L}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:`${Ue}`,children:[i("home_message.welcome")," ",n?.name,"!"]}),e.jsx(ze,{})]}),e.jsx(E,{className:L}),e.jsx(Qe,{}),e.jsx(E,{className:L}),e.jsxs(q,{className:"gap-2",children:[e.jsx(A,{to:`/contents/${me(r)}`,prefetch:"intent",children:e.jsxs(y,{children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:i("home_message.go_to_lecture")})]})}),e.jsx(A,{to:"/community",prefetch:"intent",children:e.jsxs(y,{children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:i("home_message.go_to_community")})]})})]})]}):e.jsx("main",{className:"p-8 flex flex-col justify-center items-center gap-2",children:e.jsx("p",{children:"コンテンツを読み込み中..."})}):e.jsx(le,{to:"/login",replace:!0})});export{bt as default,jt as meta};
