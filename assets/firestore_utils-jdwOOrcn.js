import{U as u,V as p,M as c,W as S,X as m,Y as w,N as n,Z as y,_ as h,$ as D,a0 as g,a1 as R,a2 as x}from"./label-Ch00gP77.js";const U=async t=>{const e=c(n,"users",t),s=await x(e);if(s.exists()){const o=s.data(),a=u(e,"contentStatus"),r=await p(a),i=new Set(r.docs.map(d=>d.id));return{uid:t,name:o.name??"",nickname:o.nickname??"",email:o.email??"",exp:o.exp??0,authority:o.authority??"user",course:o.course??"default",grade:o.grade??"beginner",contentStatus:i}}else return console.error("No user profile found in Firestore for UID:",t),null},F=async()=>{const t=u(n,"users"),e=await p(t),s=[];for(const o of e.docs){const a=o.data(),r=o.id,i=u(o.ref,"contentStatus"),d=await p(i),f=new Set(d.docs.map(l=>l.id));s.push({uid:r,...a,contentStatus:f})}return s},A=async(t,e)=>{const s=c(n,"users",t),{contentStatus:o,...a}=e;await w(s,a)},C=async t=>{const e=c(n,"users",t),s=u(e,"contentStatus"),o=await p(s),a=S(n);o.docs.forEach(r=>{a.delete(r.ref)}),await a.commit(),await m(e)},b=async(t,e)=>{const s=c(n,"users",t);await w(s,{course:e})},q=async()=>{try{const t=u(n,"notices"),e=g(t,R("createdAt","desc"));return(await p(e)).docs.map(o=>{const a=o.data();return{id:o.id,title:a.title,content:a.content,createdAt:a.createdAt.toDate(),isNew:a.isNew??!1,isImportant:a.isImportant??!1}})}catch(t){return console.error("Failed to fetch notices:",t),[]}},E=async(t,e,s,o)=>{try{const a=u(n,"notices");await y(a,{title:t,content:e,isNew:s??!0,isImportant:o??!1,createdAt:h()})}catch(a){throw console.error("Failed to create notice:",a),a}},I=async t=>{const e=c(n,"notices",t);await m(e)},T=async(t,e)=>{try{const s=c(n,"notices",t);await w(s,e)}catch(s){throw console.error(`Failed to update notice ${t}:`,s),s}},k=async(t,e)=>{if(!(!t||!e)){if(t.contentStatus&&t.contentStatus.has(e.id))return console.log("이미 완료된 강의입니다."),t;try{const s=S(n),o=c(n,"users",t.uid),a=c(o,"contentStatus",e.id),r=e.exp||0,i=t.exp+r,d=D(i),f=new Set(t.contentStatus);f.add(e.id);const l={...t,exp:i,grade:d,contentStatus:f};return s.set(a,{createdAt:h(),title:e.title}),s.update(o,{exp:l.exp,grade:l.grade}),await s.commit(),l}catch(s){throw console.error("Error completing lecture:",s),s}}};export{E as a,A as b,k as c,I as d,T as e,F as f,q as g,C as h,U as i,b as u};
