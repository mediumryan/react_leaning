import{R,b as o}from"./index-DyoFpt-A.js";import{s as _,I as P,J as A}from"./label-DhuuBEzf.js";const x={},g=o.createContext(void 0);function S(t){return o.useContext(g)||_()}function j({children:t,store:s}){const u=o.useRef(null);return s?o.createElement(g.Provider,{value:s},t):(u.current===null&&(u.current=A()),o.createElement(g.Provider,{value:u.current},t))}const v=t=>typeof t?.then=="function",h=t=>{t.status||(t.status="pending",t.then(s=>{t.status="fulfilled",t.value=s},s=>{t.status="rejected",t.reason=s}))},y=R.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(h(t),t)}),b=new WeakMap,w=(t,s)=>{let u=b.get(t);return u||(u=new Promise((c,n)=>{let l=t;const f=e=>r=>{l===e&&c(r)},d=e=>r=>{l===e&&n(r)},a=()=>{try{const e=s();v(e)?(b.set(e,u),l=e,e.then(f(e),d(e)),P(e,a)):c(e)}catch(e){n(e)}};t.then(f(t),d(t)),P(t,a)}),b.set(t,u)),u};function C(t,s){const{delay:u,unstable_promiseStatus:c=!R.use}={},n=S(),[[l,f,d],a]=o.useReducer(r=>{const i=n.get(t);return Object.is(r[0],i)&&r[1]===n&&r[2]===t?r:[i,n,t]},void 0,()=>[n.get(t),n,t]);let e=l;if((f!==n||d!==t)&&(a(),e=n.get(t)),o.useEffect(()=>{const r=n.sub(t,()=>{if(c)try{const i=n.get(t);v(i)&&h(w(i,()=>n.get(t)))}catch{}if(typeof u=="number"){setTimeout(a,u);return}a()});return a(),r},[n,t,u,c]),o.useDebugValue(e),v(e)){const r=w(e,()=>n.get(t));return c&&h(r),y(r)}return e}function E(t,s){const u=S();return o.useCallback((...n)=>{if((x?"production":void 0)!=="production"&&!("write"in t))throw new Error("not writable atom");return u.set(t,...n)},[u,t])}function k(t,s){return[C(t),E(t)]}export{j as P,k as a,C as b,E as u};
