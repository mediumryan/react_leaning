import{t as e,b as l,w as M,A as q}from"./index-DyoFpt-A.js";import{a as f,L as p,B as T,H as $,b as J}from"./label-DhuuBEzf.js";import{I as y}from"./input-DCyO1KUK.js";import{b as K,c as Q,d as V,f as W,e as X,D as z,a as Y}from"./dialog-0Telhc3y.js";import{B as O}from"./badge-B_MCz9jZ.js";import{c as P,t as U}from"./index-BuasMyr3.js";import{u as G}from"./useTranslation-CSGQyEkH.js";import{B as Z}from"./BackgroundSpinner-B5YaYS_6.js";import{f as ee,h as se,b as ae}from"./firestore_utils-r5ZB2dJD.js";import{T as te}from"./trash-2-BKHzW8sp.js";import{a as H}from"./react-BJho7Wk2.js";const re=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],le=P("search",re);const ne=[["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m14.305 16.53.923-.382",key:"1itpsq"}],["path",{d:"m15.228 13.852-.923-.383",key:"eplpkm"}],["path",{d:"m16.852 12.228-.383-.923",key:"13v3q0"}],["path",{d:"m16.852 17.772-.383.924",key:"1i8mnm"}],["path",{d:"m19.148 12.228.383-.923",key:"1q8j1v"}],["path",{d:"m19.53 18.696-.382-.924",key:"vk1qj3"}],["path",{d:"m20.772 13.852.924-.383",key:"n880s0"}],["path",{d:"m20.772 16.148.924.383",key:"1g6xey"}],["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ie=P("user-cog",ne);function oe({className:t,...a}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:f("w-full caption-bottom text-sm",t),...a})})}function ce({className:t,...a}){return e.jsx("thead",{"data-slot":"table-header",className:f("[&_tr]:border-b",t),...a})}function de({className:t,...a}){return e.jsx("tbody",{"data-slot":"table-body",className:f("[&_tr:last-child]:border-0",t),...a})}function A({className:t,...a}){return e.jsx("tr",{"data-slot":"table-row",className:f("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function h({className:t,...a}){return e.jsx("th",{"data-slot":"table-head",className:f("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function d({className:t,...a}){return e.jsx("td",{"data-slot":"table-cell",className:f("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function R({user:t,onSave:a,setOpen:D}){const{t:n}=G(),[B,_]=l.useState(t?.name??""),[N,w]=l.useState(t?.nickname??""),[g,v]=l.useState(t?.email??""),[u,i]=l.useState(t?.course??"Beginner"),[k,S]=l.useState(t?.grade??"Bronze"),[x,F]=l.useState(t?.authority??"user"),[j,L]=l.useState(t?.exp??0),m=r=>{r.preventDefault(),a({uid:t?.uid??Date.now().toString(),name:B,nickname:N,email:g,course:u,grade:k,exp:j,authority:x,contentStatus:t?.contentStatus??new Set}),D?.(!1)};return e.jsx(K,{className:"sm:max-w-120",children:e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs(Q,{children:[e.jsx(V,{children:t?n("users.users_edit_title"):""}),e.jsx(W,{})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"name",children:n("users.users_name_label")}),e.jsx(y,{id:"name",value:B,onChange:r=>_(r.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"nickname",children:n("users.users_nickname_label")}),e.jsx(y,{id:"nickname",value:N,onChange:r=>w(r.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"email",children:n("users.users_email_label")}),e.jsx(y,{id:"email",type:"email",value:g,onChange:r=>v(r.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"course",children:n("users.users_course_label")}),e.jsxs("select",{id:"course",className:"w-full h-9 rounded-md border border-input bg-background px-3 text-sm",value:u,onChange:r=>i(r.target.value),children:[e.jsx("option",{value:"Beginner",children:"Beginner"}),e.jsx("option",{value:"Intermediate",children:"Intermediate"}),e.jsx("option",{value:"Advanced",children:"Advanced"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"grade",children:n("users.users_grade_label")}),e.jsxs("select",{id:"grade",className:"w-full h-9 rounded-md border border-input bg-background px-3 text-sm",value:k,onChange:r=>S(r.target.value),children:[e.jsx("option",{value:"Bronze",children:"Bronze"}),e.jsx("option",{value:"Silver",children:"Silver"}),e.jsx("option",{value:"Gold",children:"Gold"}),e.jsx("option",{value:"Platinum",children:"Platinum"}),e.jsx("option",{value:"Diamond",children:"Diamond"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"authority",children:n("users.users_authority_label")}),e.jsxs("select",{id:"authority",className:"w-full h-9 rounded-md border border-input bg-background px-3 text-sm",value:x,onChange:r=>F(r.target.value),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"operator",children:"Operator"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"exp",children:n("users.users_exp_label")}),e.jsx(y,{id:"exp",type:"number",min:0,value:j,onChange:r=>L(Number(r.target.value)),required:!0})]})]}),e.jsx(X,{children:e.jsx(T,{type:"submit",children:n("common.save")})})]})})}const _e=M(function(){const{t:a}=G(),[D,n]=l.useState(!1),[B,_]=l.useState(!1),[N,w]=l.useState(!0),[g,v]=l.useState(null),[u,i]=H($),[k,S]=l.useState(null),[x,F]=l.useState("");l.useEffect(()=>{(async()=>{w(!0),v(null);try{const o=await ee();i(o)}catch(o){console.error("Failed to fetch users:",o),v(a("users.users_fetch_error")),i(null)}finally{w(!1)}})()},[i]);const j=u?.filter(s=>s.name.toLowerCase().includes(x.toLowerCase())||s.nickname.toLowerCase().includes(x.toLowerCase())||s.email.toLowerCase().includes(x.toLowerCase())),L=async s=>{if(!window.confirm(a("users.users_delete_confirm")))return;const o=u;i(b=>b?b.filter(c=>c.uid!==s):null);try{await se(s),U.success(a("users.users_delete_success"))}catch{U.error(a("users.users_delete_fail")),v(a("users.users_delete_fail")),i(o)}},[m,r]=H(J),E=async s=>{const o=!u?.some(c=>c.uid===s.uid),b=u;i(c=>{if(!c)return[s];const I=c.findIndex(C=>C.uid===s.uid);if(I!==-1){const C=[...c];return C[I]=s,C}else return[...c,s]}),s.uid===m?.uid&&r(s);try{o||(await ae(s.uid,s),U.success(a("users.users_edit_success")))}catch{U.error(a("users.users_save_fail")),i(b),s.uid===m?.uid&&r(m)}finally{n(!1),_(!1)}};return m?m?.authority!=="admin"&&m?.authority!=="instructor"?e.jsx(q,{to:"/",replace:!0}):N?e.jsx(Z,{}):g?e.jsxs("div",{className:"p-6 max-w-7xl mx-auto text-center text-red-500 text-lg",children:["ERROR: ",g]}):u?e.jsxs("div",{className:"p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:a("users.users_title")}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-1 sm:w-64",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(y,{placeholder:a("users.users_search_placeholder"),className:"pl-9",value:x,onChange:s=>F(s.target.value)})]}),e.jsx(z,{open:D,onOpenChange:n,children:e.jsx(R,{onSave:E})})]})]}),e.jsx("div",{className:"rounded-xl border bg-background shadow-sm overflow-x-auto",children:e.jsxs(oe,{children:[e.jsx(ce,{children:e.jsxs(A,{children:[e.jsx(h,{children:a("users.users_name_label")}),e.jsx(h,{children:a("users.users_nickname_label")}),e.jsx(h,{children:a("users.users_email_label")}),e.jsx(h,{children:a("users.users_course_label")}),e.jsx(h,{children:a("users.users_grade_label")}),e.jsx(h,{children:a("users.users_authority_label")}),e.jsx(h,{children:a("users.users_exp_label")}),e.jsx(h,{className:"text-right"})]})}),e.jsxs(de,{children:[j?.map(s=>e.jsxs(A,{children:[e.jsx(d,{className:"font-medium",children:s.name}),e.jsx(d,{children:s.nickname}),e.jsx(d,{children:s.email}),e.jsx(d,{className:"capitalize",children:s.course}),e.jsx(d,{children:e.jsx(O,{variant:"outline",className:"capitalize",children:s.grade})}),e.jsx(d,{children:e.jsx(O,{variant:s.authority==="admin"?"default":s.authority==="instructor"?"secondary":"outline",className:"capitalize",children:s.authority})}),e.jsx(d,{className:"tabular-nums",children:s.exp.toLocaleString()}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(z,{open:s===k,onOpenChange:o=>S(o?s:null),children:[e.jsx(Y,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>S(s),children:e.jsx(ie,{className:"h-4 w-4"})})}),e.jsx(R,{user:s,onSave:E,setOpen:_})]}),e.jsx(T,{variant:"ghost",size:"icon",className:"text-destructive",onClick:()=>L(s.uid),children:e.jsx(te,{className:"h-4 w-4"})})]})})]},s.uid)),(j===void 0||j.length===0)&&e.jsx(A,{children:e.jsx(d,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No users found."})})]})]})})]}):e.jsx("div",{className:"p-6 max-w-7xl mx-auto text-center text-lg",children:a("users.users_no_results")}):e.jsx(q,{to:"/login",replace:!0})});export{_e as default};
