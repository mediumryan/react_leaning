import{p as e,a as n,w as _,y as T}from"./chunk-EPOLDU6W-K4piUF01.js";import{L as x,I as N}from"./input-Dkyvn_pA.js";import{b as G,c as H,d as M,f as R,e as X,D as I,a as q,P as V,B as z}from"./dialog-oaqZQNbR.js";import{a as g,B as A,f as $,d as J,F as K,e as Q}from"./button-CAZCDkQr.js";import{b as W,c as Y,e as Z,f as ee}from"./firestore_utils-BxLobnBG.js";import{c as O}from"./index-mZfcMAy8.js";import{T as ae}from"./trash-2-CEdILdvB.js";import"./index-HXCuKcVE.js";import"./x-B083jXCI.js";const te=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],se=O("search",te);const re=[["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m14.305 16.53.923-.382",key:"1itpsq"}],["path",{d:"m15.228 13.852-.923-.383",key:"eplpkm"}],["path",{d:"m16.852 12.228-.383-.923",key:"13v3q0"}],["path",{d:"m16.852 17.772-.383.924",key:"1i8mnm"}],["path",{d:"m19.148 12.228.383-.923",key:"1q8j1v"}],["path",{d:"m19.53 18.696-.382-.924",key:"vk1qj3"}],["path",{d:"m20.772 13.852.924-.383",key:"n880s0"}],["path",{d:"m20.772 16.148.924.383",key:"1g6xey"}],["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ne=O("user-cog",re);function le({className:t,...r}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:g("w-full caption-bottom text-sm",t),...r})})}function ie({className:t,...r}){return e.jsx("thead",{"data-slot":"table-header",className:g("[&_tr]:border-b",t),...r})}function oe({className:t,...r}){return e.jsx("tbody",{"data-slot":"table-body",className:g("[&_tr:last-child]:border-0",t),...r})}function L({className:t,...r}){return e.jsx("tr",{"data-slot":"table-row",className:g("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...r})}function d({className:t,...r}){return e.jsx("th",{"data-slot":"table-head",className:g("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})}function c({className:t,...r}){return e.jsx("td",{"data-slot":"table-cell",className:g("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})}function P({user:t,onSave:r,setOpen:b}){const[F,w]=n.useState(t?.name??""),[k,S]=n.useState(t?.nickname??""),[f,h]=n.useState(t?.email??""),[u,m]=n.useState(t?.course??"Beginner"),[l,D]=n.useState(t?.grade??"Bronze"),[v,p]=n.useState(t?.authority??"user"),[C,y]=n.useState(t?.exp??0),E=s=>{s.preventDefault(),r({uid:t?.uid??Date.now().toString(),name:F,nickname:k,email:f,course:u,grade:l,exp:C,authority:v,contentStatus:t?.contentStatus??new Set}),b?.(!1)};return e.jsx(G,{className:"sm:max-w-120",children:e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs(H,{children:[e.jsx(M,{children:t?"Edit User":"Add User"}),e.jsx(R,{children:t?"Update user information.":"Create a new user account."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"name",children:"Name"}),e.jsx(N,{id:"name",value:F,onChange:s=>w(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"nickname",children:"Nickname"}),e.jsx(N,{id:"nickname",value:k,onChange:s=>S(s.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"email",children:"Email"}),e.jsx(N,{id:"email",type:"email",value:f,onChange:s=>h(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"course",children:"Course"}),e.jsxs("select",{id:"course",className:"w-full h-9 rounded-md border border-input bg-background px-3 text-sm",value:u,onChange:s=>m(s.target.value),children:[e.jsx("option",{value:"Beginner",children:"Beginner"}),e.jsx("option",{value:"Intermediate",children:"Intermediate"}),e.jsx("option",{value:"Advanced",children:"Advanced"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"grade",children:"Grade"}),e.jsxs("select",{id:"grade",className:"w-full h-9 rounded-md border border-input bg-background px-3 text-sm",value:l,onChange:s=>D(s.target.value),children:[e.jsx("option",{value:"Bronze",children:"Bronze"}),e.jsx("option",{value:"Silver",children:"Silver"}),e.jsx("option",{value:"Gold",children:"Gold"}),e.jsx("option",{value:"Platinum",children:"Platinum"}),e.jsx("option",{value:"Diamond",children:"Diamond"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"authority",children:"Authority"}),e.jsxs("select",{id:"authority",className:"w-full h-9 rounded-md border border-input bg-background px-3 text-sm",value:v,onChange:s=>p(s.target.value),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"operator",children:"Operator"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"exp",children:"EXP"}),e.jsx(N,{id:"exp",type:"number",min:0,value:C,onChange:s=>y(Number(s.target.value)),required:!0})]})]}),e.jsx(X,{children:e.jsx(A,{type:"submit",children:"Save"})})]})})}const fe=_(function(){const[r,b]=n.useState(!1),[F,w]=n.useState(!1),[k,S]=n.useState(!0),[f,h]=n.useState(null),u=$(Q),[m,l]=J(K),[D,v]=n.useState(null),[p,C]=n.useState("");n.useEffect(()=>{(async()=>{S(!0),h(null);try{const o=await W();l(o)}catch(o){console.error("Failed to fetch users:",o),h("사용자 정보를 불러오는데 실패했습니다."),l(null)}finally{S(!1)}})()},[l]);const y=m?.filter(a=>a.name.toLowerCase().includes(p.toLowerCase())||a.nickname.toLowerCase().includes(p.toLowerCase())||a.email.toLowerCase().includes(p.toLowerCase())),E=async a=>{if(!window.confirm("本当にこのユーザーを削除しますか？"))return;const o=m;l(j=>j?j.filter(i=>i.uid!==a):null);try{await Y(a),alert("ユーザーが正常に削除されました。")}catch(j){console.error("ユーザー削除に失敗しました:",j),h("ユーザー削除に失敗しました。"),l(o)}},s=async a=>{const o=!m?.some(i=>i.uid===a.uid),j=m;l(i=>{if(!i)return[a];const B=i.findIndex(U=>U.uid===a.uid);if(B!==-1){const U=[...i];return U[B]=a,U}else return[...i,a]});try{o?(await Z(a),alert("ユーザーが正常に追加されました。")):(await ee(a.uid,a),alert("ユーザー情報が正常に更新されました。"))}catch(i){console.error("ユーザー情報の保存に失敗しました:",i),h("ユーザー情報の保存に失敗しました。"),l(j)}finally{b(!1),w(!1)}};return u?u?.authority!=="admin"&&u?.authority!=="instructor"?e.jsx(T,{to:"/",replace:!0}):k?e.jsx("div",{className:"p-6 max-w-7xl mx-auto text-center text-lg",children:"ユーザー情報を読み込み中..."}):f?e.jsxs("div",{className:"p-6 max-w-7xl mx-auto text-center text-red-500 text-lg",children:["エラー: ",f]}):m?e.jsxs("div",{className:"p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"ユーザー管理"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-1 sm:w-64",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(N,{placeholder:"Search by name, nickname, email...",className:"pl-9",value:p,onChange:a=>C(a.target.value)})]}),e.jsxs(I,{open:r,onOpenChange:b,children:[e.jsx(q,{asChild:!0,children:e.jsxs(A,{children:[e.jsx(V,{className:"h-4 w-4 mr-2"})," ユーザーを追加"]})}),e.jsx(P,{onSave:s})]})]})]}),e.jsx("div",{className:"rounded-xl border bg-background shadow-sm overflow-x-auto",children:e.jsxs(le,{children:[e.jsx(ie,{children:e.jsxs(L,{children:[e.jsx(d,{children:"Name"}),e.jsx(d,{children:"Nickname"}),e.jsx(d,{children:"Email"}),e.jsx(d,{children:"Course"}),e.jsx(d,{children:"Grade"}),e.jsx(d,{children:"Authority"}),e.jsx(d,{children:"EXP"}),e.jsx(d,{className:"text-right",children:"Actions"})]})}),e.jsxs(oe,{children:[y?.map(a=>e.jsxs(L,{children:[e.jsx(c,{className:"font-medium",children:a.name}),e.jsx(c,{children:a.nickname}),e.jsx(c,{children:a.email}),e.jsx(c,{className:"capitalize",children:a.course}),e.jsx(c,{children:e.jsx(z,{variant:"outline",className:"capitalize",children:a.grade})}),e.jsx(c,{children:e.jsx(z,{variant:a.authority==="admin"?"default":a.authority==="instructor"?"secondary":"outline",className:"capitalize",children:a.authority})}),e.jsx(c,{className:"tabular-nums",children:a.exp.toLocaleString()}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(I,{open:a===D,onOpenChange:o=>v(o?a:null),children:[e.jsx(q,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>v(a),children:e.jsx(ne,{className:"h-4 w-4"})})}),e.jsx(P,{user:a,onSave:s,setOpen:w})]}),e.jsx(A,{variant:"ghost",size:"icon",className:"text-destructive",onClick:()=>E(a.uid),children:e.jsx(ae,{className:"h-4 w-4"})})]})})]},a.uid)),(y===void 0||y.length===0)&&e.jsx(L,{children:e.jsx(c,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No users found."})})]})]})})]}):e.jsx("div",{className:"p-6 max-w-7xl mx-auto text-center text-lg",children:"ユーザー情報が存在しません。"}):e.jsx(T,{to:"/login",replace:!0})});export{fe as default};
